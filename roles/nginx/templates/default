server {
	listen 80 default_server;
	server_name _;

{% if inventory_hostname in groups['web_servers'] %}
    location / {
        uwsgi_pass localhost:{{ uwsgi_port }};
        include uwsgi_params;
    }
{% endif %}

{% if inventory_hostname in groups['nginx_servers'] %}
    location /stub_status {
        stub_status on;
    }
{% endif %}

{% if inventory_hostname in groups['monitoring_servers'] %}
    location /prometheus {
        proxy_pass http://localhost:{{ prometheus_service_port }};
    }

    location /grafana {
        proxy_set_header Host $http_host;
        proxy_pass http://localhost:{{ grafana_service_port }};
    }
{% endif %}
}
